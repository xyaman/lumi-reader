# Lumi Reader API Documentation

This document provides documentation for the Lumi Reader API.
> Generated by AI, might have errors. Check the source code and tests.

## Authentication

Most endpoints require authentication. Authenticated endpoints will be marked with `Requires authentication`. To authenticate, you must include a valid session cookie in your request.

---

## Common Responses

### Success Response

*   **Status Code**: `200 OK`, `201 Created`, etc.
*   **Body**:
    ```json
    {
      "status": "success",
      "data": {} | null,
      "message": "string"
    }
    ```

### Error Response

*   **Status Code**: `400 Bad Request`, `401 Unauthorized`, `422 Unprocessable Content`, etc.
*   **Body**:
    ```json
    {
      "status": "error",
      "errors": [],
      "message": null
    }
    ```

---

## Endpoints

### Password Resets

#### `POST /v1/password_resets`

Request a password reset email.

*   **Requires authentication**: No

*   **JSON Body**:
    *   `email` (string, required): The user's email address.

*   **Response**:
    *   `200 OK`

#### `PATCH/PUT /v1/password_resets/:token`

Reset the password using a token from the password reset email.

*   **Requires authentication**: No

*   **Route Parameters**:
    *   `token` (string, required): The password reset token from the email.
*   **JSON Body**:
    *   `password_reset` (object, required):
        *   `password` (string, required): The new password. Must be at least 8 characters long.
        *   `password_confirmation` (string, required): The confirmation of the new password.

*   **Response**:
    *   `200 OK`

---

### Registrations

#### `POST /v1/registrations`

Create a new user account.

*   **Requires authentication**: No

*   **JSON Body**:
    *   `user` (object, required):
        *   `email` (string, required): The user's email address. Must be a valid email format and unique.
        *   `username` (string, required): The user's username. Must be at least 5 characters long and unique.
        *   `password` (string, required): The user's password. Must be at least 8 characters long.
        *   `password_confirmation` (string, required): The confirmation of the user's password.

*   **Response**:
    *   `201 Created`
    ```json
    {
      "id": 1,
      "username": "testuser",
      "avatar_url": null
    }
    ```

#### `GET /v1/registrations/confirm`

Confirm a user's email address.

*   **Requires authentication**: No

*   **Query Parameters**:
    *   `token` (string, required): The email confirmation token from the confirmation email.

*   **Response**:
    *   Redirects to the frontend.

---

### Sessions

#### `POST /v1/sessions`

Log in a user.

*   **Requires authentication**: No

*   **JSON Body**:
    *   `credentials` (object, required):
        *   `email` (string, required): The user's email address.
        *   `password` (string, required): The user's password.

*   **Response**:
    *   `200 OK`
    ```json
    {
      "id": 1,
      "username": "testuser",
      "avatar_url": null,
      "bio": null,
      "share_online_status": true,
      "share_presence": true,
      "following_count": 0,
      "followers_count": 0,
      "plan": {
        "id": 1,
        "name": "free",
        "book_sync_limit": 5
      },
      "email": "test@example.com"
    }
    ```

#### `GET /v1/sessions`

Get the current user's session information.

*   **Requires authentication**: Yes

*   **Response**:
    *   `200 OK`
    ```json
    {
      "id": 1,
      "username": "testuser",
      "avatar_url": null,
      "bio": null,
      "share_online_status": true,
      "share_presence": true,
      "following_count": 0,
      "followers_count": 0,
      "plan": {
        "id": 1,
        "name": "free",
        "book_sync_limit": 5
      },
      "email": "test@example.com"
    }
    ```

#### `DELETE /v1/sessions`

Log out the current user.

*   **Requires authentication**: Yes

*   **Response**:
    *   `204 No Content`

---

### Users

#### `GET /v1/users/:username`

Get a user's profile information.

*   **Requires authentication**: No

*   **Route Parameters**:
    *   `username` (string, required): The username of the user to retrieve.

*   **Response**:
    *   `200 OK`
    ```json
    {
      "id": 1,
      "username": "testuser",
      "avatar_url": null,
      "bio": null,
      "share_online_status": true,
      "share_presence": true,
      "following_count": 0,
      "followers_count": 0,
      "plan": {
        "id": 1,
        "name": "free",
        "book_sync_limit": 5
      }
    }
    ```

#### `GET /v1/users/:username/followers`

Get a list of a user's followers.

*   **Requires authentication**: No

*   **Route Parameters**:
    *   `username` (string, required): The username of the user.

*   **Response**:
    *   `200 OK`
    ```json
    [
      {
        "id": 2,
        "username": "follower1",
        "avatar_url": null
      }
    ]
    ```

#### `GET /v1/users/:username/following`

Get a list of users a user is following.

*   **Requires authentication**: No

*   **Route Parameters**:
    *   `username` (string, required): The username of the user.

*   **Response**:
    *   `200 OK`
    ```json
    [
      {
        "id": 3,
        "username": "following1",
        "avatar_url": null
      }
    ]
    ```

#### `PUT /v1/users/:username/follow`

Follow a user.

*   **Requires authentication**: Yes

*   **Route Parameters**:
    *   `username` (string, required): The username of the user to follow.

*   **Response**:
    *   `200 OK`

#### `PUT /v1/users/:username/unfollow`

Unfollow a user.

*   **Requires authentication**: Yes

*   **Route Parameters**:
    *   `username` (string, required): The username of the user to unfollow.

*   **Response**:
    *   `200 OK`
